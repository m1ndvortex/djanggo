{% extends "base_rtl.html" %}
{% load static %}

{% block title %}داشبورد تعامل مشتریان - زرگر{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/customer-engagement.css' %}">
<script src="{% static 'js/customer-engagement.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="min-h-screen 
     {% if user.theme_preference == 'dark' %}
     bg-gradient-to-br from-cyber-bg-primary via-cyber-bg-secondary to-cyber-bg-surface
     {% else %}
     bg-gradient-to-br from-gray-50 to-gray-100
     {% endif %}"
     x-data="customerEngagementDashboard()" 
     x-init="initDashboard()"
     :class="{ 'dark': darkMode, 'light': !darkMode }">

    <!-- Header -->
    <header class="{% if user.theme_preference == 'dark' %}cyber-glass-header{% else %}bg-white/80 backdrop-blur-sm border-b border-gray-200{% endif %} sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="{% if user.theme_preference == 'dark' %}cyber-logo-container{% else %}bg-blue-600 p-2 rounded-lg{% endif %}">
                        <svg class="h-8 w-8 {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-white{% endif %}" 
                             fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold {% if user.theme_preference == 'dark' %}text-cyber-text-primary cyber-glow-text{% else %}text-gray-900{% endif %}">
                            داشبورد تعامل مشتریان
                        </h1>
                        <p class="text-sm {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-blue-600{% endif %}">
                            رویدادها، یادآوری‌ها و آمار تعامل
                        </p>
                    </div>
                </div>
                
                <!-- Navigation -->
                <nav class="hidden md:flex items-center space-x-6 space-x-reverse">
                    <a href="{% url 'customers:loyalty_dashboard' %}" 
                       class="{% if user.theme_preference == 'dark' %}cyber-nav-link{% else %}nav-link{% endif %}">
                        داشبورد وفاداری
                    </a>
                    <a href="{% url 'customers:engagement_dashboard' %}" 
                       class="{% if user.theme_preference == 'dark' %}cyber-nav-link active{% else %}nav-link active{% endif %}">
                        تعامل مشتریان
                    </a>
                    <a href="{% url 'customers:birthday_reminders' %}" 
                       class="{% if user.theme_preference == 'dark' %}cyber-nav-link{% else %}nav-link{% endif %}">
                        یادآوری‌ها
                    </a>
                    <a href="/" 
                       class="{% if user.theme_preference == 'dark' %}cyber-nav-link{% else %}nav-link{% endif %}">
                        بازگشت به داشبورد
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        
        <!-- Engagement Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            
            <!-- Total Events -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-metric-card{% else %}metric-card{% endif %} animate-fade-in-up">
                <div class="flex items-center">
                    <div class="{% if user.theme_preference == 'dark' %}cyber-icon-container primary{% else %}icon-container primary{% endif %}">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <div class="mr-3">
                        <p class="text-sm font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                            کل رویدادها (۳۰ روز)
                        </p>
                        <p class="text-2xl font-bold {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary cyber-number-glow{% else %}text-gray-900{% endif %} persian-numbers">
                            {{ engagement_stats.total_events }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Delivered Events -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-metric-card{% else %}metric-card{% endif %} animate-fade-in-up" style="animation-delay: 0.1s">
                <div class="flex items-center">
                    <div class="{% if user.theme_preference == 'dark' %}cyber-icon-container success{% else %}icon-container success{% endif %}">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M5 13l4 4L19 7"/>
                        </svg>
                    </div>
                    <div class="mr-3">
                        <p class="text-sm font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                            رویدادهای تحویل شده
                        </p>
                        <p class="text-2xl font-bold {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary cyber-number-glow{% else %}text-gray-900{% endif %} persian-numbers">
                            {{ engagement_stats.delivered_events }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Engagement Rate -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-metric-card{% else %}metric-card{% endif %} animate-fade-in-up" style="animation-delay: 0.2s">
                <div class="flex items-center">
                    <div class="{% if user.theme_preference == 'dark' %}cyber-icon-container tertiary{% else %}icon-container tertiary{% endif %}">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                        </svg>
                    </div>
                    <div class="mr-3">
                        <p class="text-sm font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                            نرخ تعامل
                        </p>
                        <p class="text-2xl font-bold {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary cyber-number-glow{% else %}text-gray-900{% endif %} persian-numbers">
                            {{ engagement_rate }}%
                        </p>
                    </div>
                </div>
            </div>

            <!-- Failed Events -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-metric-card{% else %}metric-card{% endif %} animate-fade-in-up" style="animation-delay: 0.3s">
                <div class="flex items-center">
                    <div class="{% if user.theme_preference == 'dark' %}cyber-icon-container warning{% else %}icon-container warning{% endif %}">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                        </svg>
                    </div>
                    <div class="mr-3">
                        <p class="text-sm font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                            رویدادهای ناموفق
                        </p>
                        <p class="text-2xl font-bold {% if user.theme_preference == 'dark' %}text-cyber-neon-danger cyber-number-glow{% else %}text-red-600{% endif %} persian-numbers">
                            {{ engagement_stats.failed_events }}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Event Type Distribution & Upcoming Events -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            
            <!-- Event Type Distribution -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-glass-card{% else %}bg-white rounded-lg shadow{% endif %} p-6">
                <h3 class="text-lg font-semibold {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %} mb-4">
                    توزیع انواع رویداد (۳۰ روز اخیر)
                </h3>
                
                <div class="space-y-4">
                    {% for event_type in event_type_stats %}
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-4 h-4 rounded-full mr-3
                                        {% if event_type.event_type == 'birthday' %}bg-pink-500
                                        {% elif event_type.event_type == 'anniversary' %}bg-blue-500
                                        {% elif event_type.event_type == 'nowruz' %}bg-green-500
                                        {% elif event_type.event_type == 'yalda' %}bg-purple-500
                                        {% elif event_type.event_type == 'vip_upgrade' %}bg-yellow-500
                                        {% else %}bg-gray-400{% endif %}">
                            </div>
                            <span class="{% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                                {% if event_type.event_type == 'birthday' %}تولد
                                {% elif event_type.event_type == 'anniversary' %}سالگرد
                                {% elif event_type.event_type == 'nowruz' %}نوروز
                                {% elif event_type.event_type == 'yalda' %}یلدا
                                {% elif event_type.event_type == 'vip_upgrade' %}ارتقاء VIP
                                {% else %}{{ event_type.event_type }}{% endif %}
                            </span>
                        </div>
                        <span class="font-bold {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary{% else %}text-gray-900{% endif %} persian-numbers">
                            {{ event_type.count }}
                        </span>
                    </div>
                    {% empty %}
                    <p class="{% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} text-center py-4">
                        هنوز رویدادی ثبت نشده است
                    </p>
                    {% endfor %}
                </div>
            </div>

            <!-- Upcoming Events -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-glass-card{% else %}bg-white rounded-lg shadow{% endif %} p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                        رویدادهای آینده (۳۰ روز)
                    </h3>
                    <a href="{% url 'customers:engagement_events' %}" 
                       class="{% if user.theme_preference == 'dark' %}cyber-button-secondary{% else %}text-blue-600 hover:text-blue-800{% endif %} text-sm">
                        مشاهده همه
                    </a>
                </div>
                
                <div class="space-y-3 max-h-80 overflow-y-auto">
                    {% for event in upcoming_events %}
                    <div class="flex items-center justify-between p-3 {% if user.theme_preference == 'dark' %}cyber-glass-base{% else %}bg-gray-50{% endif %} rounded-lg">
                        <div class="flex items-center">
                            <div class="{% if user.theme_preference == 'dark' %}cyber-avatar{% else %}bg-blue-100 p-2 rounded-full{% endif %}">
                                {% if event.event_type == 'birthday' %}
                                <svg class="h-4 w-4 {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-pink-600{% endif %}" 
                                     fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 6c1.11 0 2-.9 2-2 0-.38-.1-.73-.29-1.03L12 0l-1.71 2.97c-.19.3-.29.65-.29 1.03 0 1.1.89 2 2 2zm4.6 9.99l-1.07-1.07-1.08 1.07c-1.3 1.3-3.58 1.31-4.89 0l-1.07-1.07L7.4 15.99C8.7 17.3 10.98 17.3 12.28 16c1.3 1.3 3.58 1.3 4.89 0-.01 0-.01 0 0 0z"/>
                                </svg>
                                {% elif event.event_type == 'anniversary' %}
                                <svg class="h-4 w-4 {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-blue-600{% endif %}" 
                                     fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                                {% else %}
                                <svg class="h-4 w-4 {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-green-600{% endif %}" 
                                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                {% endif %}
                            </div>
                            <div class="mr-3">
                                <p class="font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                                    {{ event.customer.full_persian_name }}
                                </p>
                                <p class="text-sm {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                                    {% if event.event_type == 'birthday' %}تولد
                                    {% elif event.event_type == 'anniversary' %}سالگرد
                                    {% elif event.event_type == 'nowruz' %}نوروز
                                    {% elif event.event_type == 'yalda' %}یلدا
                                    {% else %}{{ event.get_event_type_display }}{% endif %}
                                </p>
                            </div>
                        </div>
                        <div class="text-left">
                            <p class="text-sm {% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} persian-numbers">
                                {{ event.scheduled_date|date:"m/d" }}
                            </p>
                        </div>
                    </div>
                    {% empty %}
                    <p class="{% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} text-center py-4">
                        رویداد آینده‌ای برنامه‌ریزی نشده است
                    </p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Birthday & Anniversary Customers -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            
            <!-- Birthday Customers This Month -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-glass-card{% else %}bg-white rounded-lg shadow{% endif %} p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                        تولدهای این ماه
                    </h3>
                    <div class="{% if user.theme_preference == 'dark' %}cyber-badge primary{% else %}bg-pink-100 text-pink-800 px-3 py-1 rounded-full text-sm{% endif %}">
                        {{ birthday_customers.count }} نفر
                    </div>
                </div>
                
                <div class="space-y-3 max-h-64 overflow-y-auto">
                    {% for customer in birthday_customers %}
                    <div class="flex items-center justify-between p-3 {% if user.theme_preference == 'dark' %}cyber-glass-base{% else %}bg-pink-50{% endif %} rounded-lg">
                        <div class="flex items-center">
                            <div class="{% if user.theme_preference == 'dark' %}cyber-avatar{% else %}bg-pink-100 p-2 rounded-full{% endif %}">
                                <svg class="h-4 w-4 {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-pink-600{% endif %}" 
                                     fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 6c1.11 0 2-.9 2-2 0-.38-.1-.73-.29-1.03L12 0l-1.71 2.97c-.19.3-.29.65-.29 1.03 0 1.1.89 2 2 2z"/>
                                </svg>
                            </div>
                            <div class="mr-3">
                                <p class="font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                                    {{ customer.full_persian_name }}
                                </p>
                                {% if customer.is_vip %}
                                <span class="{% if user.theme_preference == 'dark' %}cyber-badge success{% else %}bg-green-100 text-green-800 px-2 py-1 rounded text-xs{% endif %}">
                                    VIP
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="text-left">
                            <p class="text-sm {% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} persian-numbers">
                                {{ customer.birth_date|date:"m/d" }}
                            </p>
                        </div>
                    </div>
                    {% empty %}
                    <p class="{% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} text-center py-4">
                        این ماه تولدی نداریم
                    </p>
                    {% endfor %}
                </div>
            </div>

            <!-- Anniversary Customers This Month -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-glass-card{% else %}bg-white rounded-lg shadow{% endif %} p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                        سالگردهای این ماه
                    </h3>
                    <div class="{% if user.theme_preference == 'dark' %}cyber-badge tertiary{% else %}bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm{% endif %}">
                        {{ anniversary_customers.count }} نفر
                    </div>
                </div>
                
                <div class="space-y-3 max-h-64 overflow-y-auto">
                    {% for customer in anniversary_customers %}
                    <div class="flex items-center justify-between p-3 {% if user.theme_preference == 'dark' %}cyber-glass-base{% else %}bg-blue-50{% endif %} rounded-lg">
                        <div class="flex items-center">
                            <div class="{% if user.theme_preference == 'dark' %}cyber-avatar{% else %}bg-blue-100 p-2 rounded-full{% endif %}">
                                <svg class="h-4 w-4 {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-blue-600{% endif %}" 
                                     fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                            </div>
                            <div class="mr-3">
                                <p class="font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                                    {{ customer.full_persian_name }}
                                </p>
                                <p class="text-xs {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                                    {% now "Y" as current_year %}
                                    {{ current_year|add:"-1"|add:customer.created_at.year|floatformat:0 }} سال مشتری
                                </p>
                            </div>
                        </div>
                        <div class="text-left">
                            <p class="text-sm {% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} persian-numbers">
                                {{ customer.created_at|date:"m/d" }}
                            </p>
                        </div>
                    </div>
                    {% empty %}
                    <p class="{% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} text-center py-4">
                        این ماه سالگردی نداریم
                    </p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Recent Engagement Events -->
        <div class="{% if user.theme_preference == 'dark' %}cyber-glass-card{% else %}bg-white rounded-lg shadow{% endif %} p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                    آخرین رویدادهای تعامل
                </h3>
                <a href="{% url 'customers:engagement_events' %}" 
                   class="{% if user.theme_preference == 'dark' %}cyber-button-secondary{% else %}bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700{% endif %}">
                    مشاهده همه رویدادها
                </a>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr class="{% if user.theme_preference == 'dark' %}border-b border-cyber-neon-primary/20{% else %}border-b border-gray-200{% endif %}">
                            <th class="text-right py-3 px-4 font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                                مشتری
                            </th>
                            <th class="text-right py-3 px-4 font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                                نوع رویداد
                            </th>
                            <th class="text-right py-3 px-4 font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                                وضعیت
                            </th>
                            <th class="text-right py-3 px-4 font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                                تاریخ ارسال
                            </th>
                            <th class="text-right py-3 px-4 font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                                روش ارسال
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for event in recent_events %}
                        <tr class="{% if user.theme_preference == 'dark' %}border-b border-cyber-neon-primary/10{% else %}border-b border-gray-100{% endif %}">
                            <td class="py-3 px-4">
                                <div class="flex items-center">
                                    <div class="{% if user.theme_preference == 'dark' %}cyber-avatar{% else %}bg-gray-100 p-1 rounded-full{% endif %}">
                                        <svg class="h-3 w-3 {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-gray-600{% endif %}" 
                                             fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                        </svg>
                                    </div>
                                    <span class="mr-2 {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                                        {{ event.customer.full_persian_name }}
                                    </span>
                                </div>
                            </td>
                            <td class="py-3 px-4 {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                                {% if event.event_type == 'birthday' %}تولد
                                {% elif event.event_type == 'anniversary' %}سالگرد
                                {% elif event.event_type == 'nowruz' %}نوروز
                                {% elif event.event_type == 'yalda' %}یلدا
                                {% else %}{{ event.get_event_type_display }}{% endif %}
                            </td>
                            <td class="py-3 px-4">
                                <span class="{% if event.status == 'delivered' %}{% if user.theme_preference == 'dark' %}cyber-badge success{% else %}bg-green-100 text-green-800 px-2 py-1 rounded text-sm{% endif %}{% elif event.status == 'sent' %}{% if user.theme_preference == 'dark' %}cyber-badge primary{% else %}bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm{% endif %}{% else %}{% if user.theme_preference == 'dark' %}cyber-badge warning{% else %}bg-red-100 text-red-800 px-2 py-1 rounded text-sm{% endif %}{% endif %}">
                                    {{ event.get_status_display }}
                                </span>
                            </td>
                            <td class="py-3 px-4 {% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} text-sm persian-numbers">
                                {% if event.sent_date %}
                                    {{ event.sent_date|date:"Y/m/d H:i" }}
                                {% else %}
                                    —
                                {% endif %}
                            </td>
                            <td class="py-3 px-4 {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                                {{ event.get_delivery_method_display }}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="py-8 text-center {% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %}">
                                هنوز رویداد تعاملی ثبت نشده است
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </main>
</div>

<script>
function customerEngagementDashboard() {
    return {
        darkMode: document.documentElement.classList.contains('dark'),
        
        initDashboard() {
            // Initialize dashboard functionality
            console.log('Customer Engagement Dashboard initialized');
            
            // Auto-refresh engagement metrics every 5 minutes
            setInterval(() => {
                this.refreshMetrics();
            }, 300000);
        },
        
        async refreshMetrics() {
            try {
                // Refresh page data
                location.reload();
            } catch (error) {
                console.error('Error refreshing metrics:', error);
            }
        }
    }
}
</script>
{% endblock %}