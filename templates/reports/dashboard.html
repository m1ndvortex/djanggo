{% extends 'base_rtl.html' %}
{% load static %}
{% load i18n %}
{% load static %}
{% load i18n %}

{% block title %}گزارش‌ها - زرگر{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/reports.css' %}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/persian-date@1.1.0/dist/persian-date.min.js"></script>
{% endblock %}

{% block content %}
<div dir="rtl" class="min-h-screen p-6 font-vazir text-right" style="font-family: 'Vazirmatn', 'Tahoma', 'Arial', sans-serif;"
            {% if is_dark_mode %}
            bg-gradient-to-br from-cyber-bg-primary via-cyber-bg-secondary to-cyber-bg-surface
            {% else %}
            bg-gray-50
            {% endif %}">
    
    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h1 class="text-3xl font-bold 
                           {% if is_dark_mode %}
                           text-cyber-text-primary bg-gradient-to-r from-cyber-neon-primary to-cyber-neon-secondary bg-clip-text text-transparent
                           {% else %}
                           text-gray-900
                           {% endif %}">
                    داشبورد گزارش‌های مالی و عملیاتی
                </h1>
                <p class="mt-2 
                         {% if is_dark_mode %}
                         text-cyber-text-secondary
                         {% else %}
                         text-gray-600
                         {% endif %}">
                    مدیریت و تولید گزارش‌های جامع کسب‌وکار
                </p>
            </div>
            
            <!-- Quick Actions -->
            <div class="flex space-x-4 space-x-reverse">
                <a href="{% url 'reports:generate' %}" 
                   class="inline-flex items-center px-6 py-3 rounded-lg font-medium transition-all duration-300
                          {% if is_dark_mode %}
                          bg-gradient-to-r from-cyber-neon-primary/20 to-cyber-neon-secondary/20 
                          border border-cyber-neon-primary/30 text-cyber-text-primary
                          hover:border-cyber-neon-primary/50 hover:shadow-lg hover:shadow-cyber-neon-primary/20
                          {% else %}
                          bg-blue-600 text-white hover:bg-blue-700 shadow-sm hover:shadow-md
                          {% endif %}">
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    تولید گزارش جدید
                </a>
                
                <a href="{% url 'reports:schedule_list' %}" 
                   class="inline-flex items-center px-6 py-3 rounded-lg font-medium transition-all duration-300
                          {% if is_dark_mode %}
                          bg-cyber-bg-surface/80 border border-cyber-border-glass text-cyber-text-primary
                          hover:border-cyber-neon-secondary/30 hover:bg-cyber-bg-elevated/80
                          {% else %}
                          bg-white border border-gray-300 text-gray-700 hover:bg-gray-50
                          {% endif %}">
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    زمان‌بندی گزارش‌ها
                </a>
            </div>
        </div>
        
        <!-- Current Date Display -->
        <div class="text-sm 
                    {% if is_dark_mode %}
                    text-cyber-text-secondary
                    {% else %}
                    text-gray-500
                    {% endif %}">
            امروز: {{ current_shamsi_date }}
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Total Reports -->
        <div class="p-6 rounded-xl transition-all duration-300 hover:scale-105
                    {% if is_dark_mode %}
                    bg-gradient-to-br from-cyber-bg-surface/80 to-cyber-bg-elevated/80 
                    border border-cyber-border-glass backdrop-blur-sm
                    hover:border-cyber-neon-primary/30 hover:shadow-cyber
                    {% else %}
                    bg-white border border-gray-200 shadow-sm hover:shadow-md
                    {% endif %}">
            <div class="flex items-center">
                <div class="p-3 rounded-lg 
                           {% if is_dark_mode %}
                           bg-cyber-neon-primary/20 text-cyber-neon-primary
                           {% else %}
                           bg-blue-100 text-blue-600
                           {% endif %}">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
                <div class="mr-4">
                    <p class="text-sm font-medium 
                             {% if is_dark_mode %}
                             text-cyber-text-secondary
                             {% else %}
                             text-gray-600
                             {% endif %}">
                        کل گزارش‌ها
                    </p>
                    <p class="text-2xl font-bold persian-numbers
                             {% if is_dark_mode %}
                             text-cyber-text-numbers
                             {% else %}
                             text-gray-900
                             {% endif %}">
                        {{ total_reports }}
                    </p>
                </div>
            </div>
        </div>

        <!-- This Month Reports -->
        <div class="p-6 rounded-xl transition-all duration-300 hover:scale-105
                    {% if is_dark_mode %}
                    bg-gradient-to-br from-cyber-bg-surface/80 to-cyber-bg-elevated/80 
                    border border-cyber-border-glass backdrop-blur-sm
                    hover:border-cyber-neon-secondary/30 hover:shadow-cyber
                    {% else %}
                    bg-white border border-gray-200 shadow-sm hover:shadow-md
                    {% endif %}">
            <div class="flex items-center">
                <div class="p-3 rounded-lg 
                           {% if is_dark_mode %}
                           bg-cyber-neon-secondary/20 text-cyber-neon-secondary
                           {% else %}
                           bg-green-100 text-green-600
                           {% endif %}">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <div class="mr-4">
                    <p class="text-sm font-medium 
                             {% if is_dark_mode %}
                             text-cyber-text-secondary
                             {% else %}
                             text-gray-600
                             {% endif %}">
                        گزارش‌های این ماه
                    </p>
                    <p class="text-2xl font-bold persian-numbers
                             {% if is_dark_mode %}
                             text-cyber-text-numbers
                             {% else %}
                             text-gray-900
                             {% endif %}">
                        {{ reports_this_month }}
                    </p>
                </div>
            </div>
        </div>

        <!-- Active Schedules -->
        <div class="p-6 rounded-xl transition-all duration-300 hover:scale-105
                    {% if is_dark_mode %}
                    bg-gradient-to-br from-cyber-bg-surface/80 to-cyber-bg-elevated/80 
                    border border-cyber-border-glass backdrop-blur-sm
                    hover:border-cyber-neon-tertiary/30 hover:shadow-cyber
                    {% else %}
                    bg-white border border-gray-200 shadow-sm hover:shadow-md
                    {% endif %}">
            <div class="flex items-center">
                <div class="p-3 rounded-lg 
                           {% if is_dark_mode %}
                           bg-cyber-neon-tertiary/20 text-cyber-neon-tertiary
                           {% else %}
                           bg-orange-100 text-orange-600
                           {% endif %}">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="mr-4">
                    <p class="text-sm font-medium 
                             {% if is_dark_mode %}
                             text-cyber-text-secondary
                             {% else %}
                             text-gray-600
                             {% endif %}">
                        زمان‌بندی‌های فعال
                    </p>
                    <p class="text-2xl font-bold persian-numbers
                             {% if is_dark_mode %}
                             text-cyber-text-numbers
                             {% else %}
                             text-gray-900
                             {% endif %}">
                        {{ active_schedules|length }}
                    </p>
                </div>
            </div>
        </div>

        <!-- Templates Available -->
        <div class="p-6 rounded-xl transition-all duration-300 hover:scale-105
                    {% if is_dark_mode %}
                    bg-gradient-to-br from-cyber-bg-surface/80 to-cyber-bg-elevated/80 
                    border border-cyber-border-glass backdrop-blur-sm
                    hover:border-cyber-neon-purple/30 hover:shadow-cyber
                    {% else %}
                    bg-white border border-gray-200 shadow-sm hover:shadow-md
                    {% endif %}">
            <div class="flex items-center">
                <div class="p-3 rounded-lg 
                           {% if is_dark_mode %}
                           bg-cyber-neon-purple/20 text-cyber-neon-purple
                           {% else %}
                           bg-purple-100 text-purple-600
                           {% endif %}">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                </div>
                <div class="mr-4">
                    <p class="text-sm font-medium 
                             {% if is_dark_mode %}
                             text-cyber-text-secondary
                             {% else %}
                             text-gray-600
                             {% endif %}">
                        قالب‌های موجود
                    </p>
                    <p class="text-2xl font-bold persian-numbers
                             {% if is_dark_mode %}
                             text-cyber-text-numbers
                             {% else %}
                             text-gray-900
                             {% endif %}">
                        {% for templates in templates_by_type.values %}{{ templates|length }}{% empty %}0{% endfor %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Report Templates Section -->
        <div class="lg:col-span-2">
            <div class="p-6 rounded-xl 
                        {% if is_dark_mode %}
                        bg-gradient-to-br from-cyber-bg-surface/80 to-cyber-bg-elevated/80 
                        border border-cyber-border-glass backdrop-blur-sm
                        {% else %}
                        bg-white border border-gray-200 shadow-sm
                        {% endif %}">
                
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold 
                               {% if is_dark_mode %}
                               text-cyber-text-primary
                               {% else %}
                               text-gray-900
                               {% endif %}">
                        قالب‌های گزارش
                    </h2>
                    <a href="{% url 'reports:template_list' %}" 
                       class="text-sm font-medium 
                              {% if is_dark_mode %}
                              text-cyber-neon-primary hover:text-cyber-neon-secondary
                              {% else %}
                              text-blue-600 hover:text-blue-800
                              {% endif %} 
                              transition-colors">
                        مشاهده همه
                    </a>
                </div>

                {% if templates_by_type %}
                    <div class="space-y-6">
                        {% for report_type, templates in templates_by_type.items %}
                        <div>
                            <h3 class="text-lg font-semibold mb-3 
                                       {% if is_dark_mode %}
                                       text-cyber-text-primary
                                       {% else %}
                                       text-gray-800
                                       {% endif %}">
                                {{ report_type }}
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {% for template in templates %}
                                <div class="p-4 rounded-lg border transition-all duration-300 hover:scale-105
                                           {% if is_dark_mode %}
                                           bg-cyber-bg-surface/60 border-cyber-border-glass
                                           hover:border-cyber-neon-primary/30 hover:bg-cyber-bg-elevated/60
                                           {% else %}
                                           bg-gray-50 border-gray-200 hover:bg-gray-100 hover:border-gray-300
                                           {% endif %}">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="font-medium 
                                                       {% if is_dark_mode %}
                                                       text-cyber-text-primary
                                                       {% else %}
                                                       text-gray-900
                                                       {% endif %}">
                                                {{ template.name_persian|default:template.name }}
                                            </h4>
                                            <p class="text-sm mt-1 
                                                     {% if is_dark_mode %}
                                                     text-cyber-text-secondary
                                                     {% else %}
                                                     text-gray-600
                                                     {% endif %}">
                                                {{ template.description|truncatechars:50 }}
                                            </p>
                                        </div>
                                        <a href="{% url 'reports:generate_template' template.id %}" 
                                           class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-all duration-300
                                                  {% if is_dark_mode %}
                                                  bg-cyber-neon-primary/20 text-cyber-neon-primary border border-cyber-neon-primary/30
                                                  hover:bg-cyber-neon-primary/30 hover:border-cyber-neon-primary/50
                                                  {% else %}
                                                  bg-blue-100 text-blue-700 hover:bg-blue-200
                                                  {% endif %}">
                                            تولید
                                        </a>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-12">
                        <svg class="mx-auto h-12 w-12 
                                   {% if is_dark_mode %}
                                   text-cyber-text-muted
                                   {% else %}
                                   text-gray-400
                                   {% endif %}" 
                             fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <h3 class="mt-2 text-sm font-medium 
                                   {% if is_dark_mode %}
                                   text-cyber-text-secondary
                                   {% else %}
                                   text-gray-900
                                   {% endif %}">
                            هیچ قالب گزارشی موجود نیست
                        </h3>
                        <p class="mt-1 text-sm 
                                 {% if is_dark_mode %}
                                 text-cyber-text-muted
                                 {% else %}
                                 text-gray-500
                                 {% endif %}">
                            برای شروع، قالب گزارش جدیدی ایجاد کنید.
                        </p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            
            <!-- Recent Reports -->
            <div class="p-6 rounded-xl 
                        {% if is_dark_mode %}
                        bg-gradient-to-br from-cyber-bg-surface/80 to-cyber-bg-elevated/80 
                        border border-cyber-border-glass backdrop-blur-sm
                        {% else %}
                        bg-white border border-gray-200 shadow-sm
                        {% endif %}">
                
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold 
                               {% if is_dark_mode %}
                               text-cyber-text-primary
                               {% else %}
                               text-gray-900
                               {% endif %}">
                        گزارش‌های اخیر
                    </h3>
                    <a href="{% url 'reports:list' %}" 
                       class="text-sm font-medium 
                              {% if is_dark_mode %}
                              text-cyber-neon-primary hover:text-cyber-neon-secondary
                              {% else %}
                              text-blue-600 hover:text-blue-800
                              {% endif %} 
                              transition-colors">
                        مشاهده همه
                    </a>
                </div>

                {% if recent_reports %}
                    <div class="space-y-3">
                        {% for report in recent_reports %}
                        <div class="flex items-center justify-between p-3 rounded-lg
                                   {% if is_dark_mode %}
                                   bg-cyber-bg-surface/60 border border-cyber-border-glass
                                   {% else %}
                                   bg-gray-50 border border-gray-200
                                   {% endif %}">
                            <div class="flex-1">
                                <p class="text-sm font-medium 
                                         {% if is_dark_mode %}
                                         text-cyber-text-primary
                                         {% else %}
                                         text-gray-900
                                         {% endif %}">
                                    {{ report.template.name_persian|default:report.template.name }}
                                </p>
                                <p class="text-xs 
                                         {% if is_dark_mode %}
                                         text-cyber-text-secondary
                                         {% else %}
                                         text-gray-500
                                         {% endif %}">
                                    {{ report.generated_at|date:"Y/m/d H:i" }}
                                </p>
                            </div>
                            <div class="flex items-center space-x-2 space-x-reverse">
                                {% if report.status == 'completed' %}
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
                                                 {% if is_dark_mode %}
                                                 bg-cyber-neon-success/20 text-cyber-neon-success
                                                 {% else %}
                                                 bg-green-100 text-green-800
                                                 {% endif %}">
                                        تکمیل شده
                                    </span>
                                    <a href="{% url 'reports:report_detail' report.report_id %}" 
                                       class="text-sm 
                                              {% if is_dark_mode %}
                                              text-cyber-neon-primary hover:text-cyber-neon-secondary
                                              {% else %}
                                              text-blue-600 hover:text-blue-800
                                              {% endif %}">
                                        مشاهده
                                    </a>
                                {% elif report.status == 'generating' %}
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
                                                 {% if is_dark_mode %}
                                                 bg-cyber-neon-warning/20 text-cyber-neon-warning
                                                 {% else %}
                                                 bg-yellow-100 text-yellow-800
                                                 {% endif %}">
                                        در حال تولید
                                    </span>
                                {% elif report.status == 'failed' %}
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
                                                 {% if is_dark_mode %}
                                                 bg-cyber-neon-danger/20 text-cyber-neon-danger
                                                 {% else %}
                                                 bg-red-100 text-red-800
                                                 {% endif %}">
                                        خطا
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-sm text-center py-4 
                             {% if is_dark_mode %}
                             text-cyber-text-secondary
                             {% else %}
                             text-gray-500
                             {% endif %}">
                        هیچ گزارش اخیری موجود نیست
                    </p>
                {% endif %}
            </div>

            <!-- Active Schedules -->
            <div class="p-6 rounded-xl 
                        {% if is_dark_mode %}
                        bg-gradient-to-br from-cyber-bg-surface/80 to-cyber-bg-elevated/80 
                        border border-cyber-border-glass backdrop-blur-sm
                        {% else %}
                        bg-white border border-gray-200 shadow-sm
                        {% endif %}">
                
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold 
                               {% if is_dark_mode %}
                               text-cyber-text-primary
                               {% else %}
                               text-gray-900
                               {% endif %}">
                        زمان‌بندی‌های فعال
                    </h3>
                    <a href="{% url 'reports:schedule_create' %}" 
                       class="text-sm font-medium 
                              {% if is_dark_mode %}
                              text-cyber-neon-primary hover:text-cyber-neon-secondary
                              {% else %}
                              text-blue-600 hover:text-blue-800
                              {% endif %} 
                              transition-colors">
                        ایجاد جدید
                    </a>
                </div>

                {% if active_schedules %}
                    <div class="space-y-3">
                        {% for schedule in active_schedules %}
                        <div class="p-3 rounded-lg
                                   {% if is_dark_mode %}
                                   bg-cyber-bg-surface/60 border border-cyber-border-glass
                                   {% else %}
                                   bg-gray-50 border border-gray-200
                                   {% endif %}">
                            <p class="text-sm font-medium 
                                     {% if is_dark_mode %}
                                     text-cyber-text-primary
                                     {% else %}
                                     text-gray-900
                                     {% endif %}">
                                {{ schedule.name_persian|default:schedule.name }}
                            </p>
                            <p class="text-xs 
                                     {% if is_dark_mode %}
                                     text-cyber-text-secondary
                                     {% else %}
                                     text-gray-500
                                     {% endif %}">
                                اجرای بعدی: {{ schedule.next_execution|date:"Y/m/d H:i" }}
                            </p>
                            <div class="flex items-center justify-between mt-2">
                                <span class="text-xs 
                                           {% if is_dark_mode %}
                                           text-cyber-text-muted
                                           {% else %}
                                           text-gray-400
                                           {% endif %}">
                                    {{ schedule.get_frequency_display }}
                                </span>
                                <a href="{% url 'reports:schedule_edit' schedule.pk %}" 
                                   class="text-xs 
                                          {% if is_dark_mode %}
                                          text-cyber-neon-primary hover:text-cyber-neon-secondary
                                          {% else %}
                                          text-blue-600 hover:text-blue-800
                                          {% endif %}">
                                    ویرایش
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-sm text-center py-4 
                             {% if is_dark_mode %}
                             text-cyber-text-secondary
                             {% else %}
                             text-gray-500
                             {% endif %}">
                        هیچ زمان‌بندی فعالی موجود نیست
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/reports-dashboard.js' %}"></script>
{% endblock %}