{% extends "base_rtl.html" %}
{% load static %}
{% load i18n %}

{% block title %}فهرست موجودی - زرگر{% endblock %}

{% block extra_head %}
<style>
    .filter-card {
        backdrop-filter: blur(16px) saturate(150%);
        background: linear-gradient(145deg, 
            rgba(37, 42, 58, 0.8) 0%, 
            rgba(26, 29, 41, 0.9) 50%,
            rgba(11, 14, 26, 0.95) 100%);
        border: 1px solid rgba(255, 255, 255, 0.04);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.03);
    }
    
    .item-card {
        transition: all 0.3s ease;
    }
    
    .item-card:hover {
        transform: translateY(-2px);
    }
    
    .dark .item-card:hover {
        box-shadow: 0 16px 50px rgba(0, 0, 0, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    .status-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 0.375rem;
        font-weight: 500;
    }
    
    .search-input {
        transition: all 0.3s ease;
    }
    
    .search-input:focus {
        transform: scale(1.02);
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold mb-2
                       {% if is_dark_mode %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                فهرست موجودی
            </h1>
            <p class="{% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                مدیریت و جستجوی کالاهای موجود
            </p>
        </div>
        
        <div class="flex flex-wrap gap-3 mt-4 md:mt-0">
            <a href="{% url 'jewelry:inventory_create' %}" 
               class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all duration-300
                      {% if is_dark_mode %}
                      bg-gradient-to-r from-cyber-neon-primary/20 to-cyber-neon-secondary/20 
                      border border-cyber-neon-primary/30 text-cyber-neon-primary
                      hover:border-cyber-neon-primary/50 hover:shadow-lg hover:shadow-cyber-neon-primary/20
                      {% else %}
                      bg-blue-600 text-white border border-blue-600
                      hover:bg-blue-700 hover:border-blue-700
                      {% endif %}">
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                افزودن کالای جدید
            </a>
            
            <a href="{% url 'jewelry:dashboard' %}" 
               class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all duration-300
                      {% if is_dark_mode %}
                      bg-cyber-bg-surface/50 border border-cyber-text-muted/30 text-cyber-text-secondary
                      hover:border-cyber-text-secondary/50
                      {% else %}
                      bg-white text-gray-700 border border-gray-300
                      hover:bg-gray-50 hover:border-gray-400
                      {% endif %}">
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                </svg>
                بازگشت به داشبورد
            </a>
        </div>
    </div>

    <!-- Filters -->
    <div class="{% if is_dark_mode %}filter-card{% else %}bg-white border border-gray-200 shadow-sm{% endif %} 
                rounded-xl p-6 mb-8">
        <form method="get" class="space-y-4" id="filterForm">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Search -->
                <div class="lg:col-span-2">
                    <label class="block text-sm font-medium mb-2
                                 {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-700{% endif %}">
                        جستجو
                    </label>
                    <div class="relative">
                        <input type="text" 
                               name="search" 
                               value="{{ current_filters.search }}"
                               placeholder="نام، کد کالا، بارکد یا توضیحات..."
                               class="search-input w-full pl-10 pr-4 py-2 rounded-lg border transition-all duration-300
                                      {% if is_dark_mode %}
                                      bg-cyber-bg-surface/50 border-cyber-text-muted/30 text-cyber-text-primary
                                      placeholder-cyber-text-muted focus:border-cyber-neon-primary/50
                                      {% else %}
                                      bg-white border-gray-300 text-gray-900
                                      placeholder-gray-500 focus:border-blue-500 focus:ring-blue-500
                                      {% endif %}">
                        <svg class="absolute left-3 top-2.5 w-5 h-5 {% if is_dark_mode %}text-cyber-text-muted{% else %}text-gray-400{% endif %}" 
                             fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                </div>
                
                <!-- Category Filter -->
                <div>
                    <label class="block text-sm font-medium mb-2
                                 {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-700{% endif %}">
                        دسته‌بندی
                    </label>
                    <select name="category" 
                            class="w-full px-3 py-2 rounded-lg border
                                   {% if is_dark_mode %}
                                   bg-cyber-bg-surface/50 border-cyber-text-muted/30 text-cyber-text-primary
                                   {% else %}
                                   bg-white border-gray-300 text-gray-900
                                   {% endif %}">
                        <option value="">همه دسته‌بندی‌ها</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}" 
                                {% if current_filters.category == category.id|stringformat:"s" %}selected{% endif %}>
                            {{ category.name_persian|default:category.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Status Filter -->
                <div>
                    <label class="block text-sm font-medium mb-2
                                 {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-700{% endif %}">
                        وضعیت
                    </label>
                    <select name="status" 
                            class="w-full px-3 py-2 rounded-lg border
                                   {% if is_dark_mode %}
                                   bg-cyber-bg-surface/50 border-cyber-text-muted/30 text-cyber-text-primary
                                   {% else %}
                                   bg-white border-gray-300 text-gray-900
                                   {% endif %}">
                        <option value="">همه وضعیت‌ها</option>
                        {% for status_key, status_label in status_choices %}
                        <option value="{{ status_key }}" 
                                {% if current_filters.status == status_key %}selected{% endif %}>
                            {{ status_label }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                <!-- Karat Filter -->
                <div>
                    <label class="block text-sm font-medium mb-2
                                 {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-700{% endif %}">
                        عیار
                    </label>
                    <select name="karat" 
                            class="w-full px-3 py-2 rounded-lg border
                                   {% if is_dark_mode %}
                                   bg-cyber-bg-surface/50 border-cyber-text-muted/30 text-cyber-text-primary
                                   {% else %}
                                   bg-white border-gray-300 text-gray-900
                                   {% endif %}">
                        <option value="">همه عیارها</option>
                        {% for karat_value, karat_label in karat_choices %}
                        <option value="{{ karat_value }}" 
                                {% if current_filters.karat == karat_value|stringformat:"s" %}selected{% endif %}>
                            {{ karat_label }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Price Range -->
                <div>
                    <label class="block text-sm font-medium mb-2
                                 {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-700{% endif %}">
                        حداقل قیمت (تومان)
                    </label>
                    <input type="number" 
                           name="min_price" 
                           value="{{ current_filters.min_price }}"
                           placeholder="0"
                           class="w-full px-3 py-2 rounded-lg border
                                  {% if is_dark_mode %}
                                  bg-cyber-bg-surface/50 border-cyber-text-muted/30 text-cyber-text-primary
                                  placeholder-cyber-text-muted
                                  {% else %}
                                  bg-white border-gray-300 text-gray-900
                                  placeholder-gray-500
                                  {% endif %}">
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2
                                 {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-700{% endif %}">
                        حداکثر قیمت (تومان)
                    </label>
                    <input type="number" 
                           name="max_price" 
                           value="{{ current_filters.max_price }}"
                           placeholder="نامحدود"
                           class="w-full px-3 py-2 rounded-lg border
                                  {% if is_dark_mode %}
                                  bg-cyber-bg-surface/50 border-cyber-text-muted/30 text-cyber-text-primary
                                  placeholder-cyber-text-muted
                                  {% else %}
                                  bg-white border-gray-300 text-gray-900
                                  placeholder-gray-500
                                  {% endif %}">
                </div>
                
                <!-- Low Stock Filter -->
                <div>
                    <label class="block text-sm font-medium mb-2
                                 {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-700{% endif %}">
                        موجودی کم
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" 
                               name="low_stock" 
                               value="true"
                               {% if current_filters.low_stock == 'true' %}checked{% endif %}
                               class="rounded border-gray-300 
                                      {% if is_dark_mode %}
                                      text-cyber-neon-primary focus:ring-cyber-neon-primary/50
                                      {% else %}
                                      text-blue-600 focus:ring-blue-500
                                      {% endif %}">
                        <span class="mr-2 text-sm
                                   {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-700{% endif %}">
                            فقط کالاهای کم موجود
                        </span>
                    </label>
                </div>
                
                <!-- Sort -->
                <div>
                    <label class="block text-sm font-medium mb-2
                                 {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-700{% endif %}">
                        مرتب‌سازی
                    </label>
                    <select name="sort" 
                            class="w-full px-3 py-2 rounded-lg border
                                   {% if is_dark_mode %}
                                   bg-cyber-bg-surface/50 border-cyber-text-muted/30 text-cyber-text-primary
                                   {% else %}
                                   bg-white border-gray-300 text-gray-900
                                   {% endif %}">
                        <option value="-created_at" {% if current_filters.sort == '-created_at' %}selected{% endif %}>جدیدترین</option>
                        <option value="created_at" {% if current_filters.sort == 'created_at' %}selected{% endif %}>قدیمی‌ترین</option>
                        <option value="name" {% if current_filters.sort == 'name' %}selected{% endif %}>نام (الف-ی)</option>
                        <option value="-name" {% if current_filters.sort == '-name' %}selected{% endif %}>نام (ی-الف)</option>
                        <option value="-selling_price" {% if current_filters.sort == '-selling_price' %}selected{% endif %}>گران‌ترین</option>
                        <option value="selling_price" {% if current_filters.sort == 'selling_price' %}selected{% endif %}>ارزان‌ترین</option>
                        <option value="-quantity" {% if current_filters.sort == '-quantity' %}selected{% endif %}>بیشترین موجودی</option>
                        <option value="quantity" {% if current_filters.sort == 'quantity' %}selected{% endif %}>کمترین موجودی</option>
                    </select>
                </div>
            </div>
            
            <div class="flex flex-wrap gap-3 pt-4">
                <button type="submit" 
                        class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all duration-300
                               {% if is_dark_mode %}
                               bg-gradient-to-r from-cyber-neon-primary/20 to-cyber-neon-secondary/20 
                               border border-cyber-neon-primary/30 text-cyber-neon-primary
                               hover:border-cyber-neon-primary/50 hover:shadow-lg hover:shadow-cyber-neon-primary/20
                               {% else %}
                               bg-blue-600 text-white border border-blue-600
                               hover:bg-blue-700 hover:border-blue-700
                               {% endif %}">
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    جستجو
                </button>
                
                <a href="{% url 'jewelry:inventory_list' %}" 
                   class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all duration-300
                          {% if is_dark_mode %}
                          bg-cyber-bg-surface/50 border border-cyber-text-muted/30 text-cyber-text-secondary
                          hover:border-cyber-text-secondary/50
                          {% else %}
                          bg-white text-gray-700 border border-gray-300
                          hover:bg-gray-50 hover:border-gray-400
                          {% endif %}">
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    پاک کردن فیلترها
                </a>
            </div>
        </form>
    </div>

    <!-- Results -->
    <div class="{% if is_dark_mode %}filter-card{% else %}bg-white border border-gray-200 shadow-sm{% endif %} 
                rounded-xl overflow-hidden">
        
        <!-- Results Header -->
        <div class="px-6 py-4 border-b 
                    {% if is_dark_mode %}border-cyber-text-muted/20{% else %}border-gray-200{% endif %}">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-bold
                         {% if is_dark_mode %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                    نتایج جستجو
                    {% if items %}
                    <span class="text-sm font-normal persian-numbers
                                {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                        ({{ paginator.count }} کالا)
                    </span>
                    {% endif %}
                </h2>
                
                {% if items %}
                <div class="flex items-center space-x-2 space-x-reverse">
                    <span class="text-sm {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                        نمایش در هر صفحه:
                    </span>
                    <select onchange="changePageSize(this.value)" 
                            class="px-2 py-1 rounded border text-sm
                                   {% if is_dark_mode %}
                                   bg-cyber-bg-surface/50 border-cyber-text-muted/30 text-cyber-text-primary
                                   {% else %}
                                   bg-white border-gray-300 text-gray-900
                                   {% endif %}">
                        <option value="20" {% if request.GET.page_size == '20' or not request.GET.page_size %}selected{% endif %}>20</option>
                        <option value="50" {% if request.GET.page_size == '50' %}selected{% endif %}>50</option>
                        <option value="100" {% if request.GET.page_size == '100' %}selected{% endif %}>100</option>
                    </select>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Items Grid -->
        {% if items %}
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {% for item in items %}
                <div class="item-card rounded-xl overflow-hidden
                           {% if is_dark_mode %}
                           bg-cyber-bg-surface/30 border border-cyber-text-muted/10
                           {% else %}
                           bg-white border border-gray-200 shadow-sm
                           {% endif %}">
                    
                    <!-- Item Image -->
                    <div class="relative h-48 overflow-hidden">
                        {% if item.photos.first %}
                        <img src="{{ item.photos.first.image.url }}" 
                             alt="{{ item.name }}"
                             class="w-full h-full object-cover">
                        {% else %}
                        <div class="w-full h-full flex items-center justify-center
                                    {% if is_dark_mode %}bg-cyber-bg-elevated{% else %}bg-gray-100{% endif %}">
                            <svg class="w-16 h-16 {% if is_dark_mode %}text-cyber-text-muted{% else %}text-gray-400{% endif %}" 
                                 fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        {% endif %}
                        
                        <!-- Status Badge -->
                        <div class="absolute top-2 right-2">
                            <span class="status-badge
                                       {% if item.status == 'in_stock' %}
                                       {% if is_dark_mode %}bg-cyber-neon-secondary/20 text-cyber-neon-secondary border border-cyber-neon-secondary/30{% else %}bg-green-100 text-green-800 border border-green-200{% endif %}
                                       {% elif item.status == 'sold' %}
                                       {% if is_dark_mode %}bg-cyber-text-muted/20 text-cyber-text-muted border border-cyber-text-muted/30{% else %}bg-gray-100 text-gray-800 border border-gray-200{% endif %}
                                       {% elif item.status == 'reserved' %}
                                       {% if is_dark_mode %}bg-cyber-neon-warning/20 text-cyber-neon-warning border border-cyber-neon-warning/30{% else %}bg-yellow-100 text-yellow-800 border border-yellow-200{% endif %}
                                       {% else %}
                                       {% if is_dark_mode %}bg-cyber-neon-danger/20 text-cyber-neon-danger border border-cyber-neon-danger/30{% else %}bg-red-100 text-red-800 border border-red-200{% endif %}
                                       {% endif %}">
                                {{ item.get_status_display }}
                            </span>
                        </div>
                        
                        <!-- Low Stock Warning -->
                        {% if item.is_low_stock and item.status == 'in_stock' %}
                        <div class="absolute top-2 left-2">
                            <span class="status-badge
                                       {% if is_dark_mode %}bg-cyber-neon-danger/20 text-cyber-neon-danger border border-cyber-neon-danger/30{% else %}bg-red-100 text-red-800 border border-red-200{% endif %}">
                                کم موجود
                            </span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Item Details -->
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-2 line-clamp-2
                                 {% if is_dark_mode %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                            {{ item.name }}
                        </h3>
                        
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center justify-between text-sm">
                                <span class="{% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                                    کد کالا:
                                </span>
                                <span class="font-medium persian-numbers
                                           {% if is_dark_mode %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                                    {{ item.sku }}
                                </span>
                            </div>
                            
                            <div class="flex items-center justify-between text-sm">
                                <span class="{% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                                    دسته‌بندی:
                                </span>
                                <span class="{% if is_dark_mode %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                                    {{ item.category.name_persian|default:item.category.name }}
                                </span>
                            </div>
                            
                            <div class="flex items-center justify-between text-sm">
                                <span class="{% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                                    وزن/عیار:
                                </span>
                                <span class="persian-numbers
                                           {% if is_dark_mode %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                                    {{ item.weight_grams }} گرم / {{ item.karat }} عیار
                                </span>
                            </div>
                            
                            <div class="flex items-center justify-between text-sm">
                                <span class="{% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                                    موجودی:
                                </span>
                                <span class="persian-numbers font-medium
                                           {% if item.is_low_stock %}
                                           {% if is_dark_mode %}text-cyber-neon-danger{% else %}text-red-600{% endif %}
                                           {% else %}
                                           {% if is_dark_mode %}text-cyber-neon-secondary{% else %}text-green-600{% endif %}
                                           {% endif %}">
                                    {{ item.quantity }}
                                </span>
                            </div>
                        </div>
                        
                        <!-- Price -->
                        {% if item.selling_price %}
                        <div class="mb-4">
                            <div class="text-center">
                                <span class="text-2xl font-bold persian-numbers
                                           {% if is_dark_mode %}text-cyber-neon-primary{% else %}text-blue-600{% endif %}">
                                    {{ item.selling_price|floatformat:0 }}
                                </span>
                                <span class="text-sm
                                           {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                                    تومان
                                </span>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Actions -->
                        <div class="flex gap-2">
                            <a href="{% url 'jewelry:inventory_detail' item.pk %}" 
                               class="flex-1 text-center px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300
                                      {% if is_dark_mode %}
                                      bg-cyber-neon-primary/20 border border-cyber-neon-primary/30 text-cyber-neon-primary
                                      hover:border-cyber-neon-primary/50 hover:bg-cyber-neon-primary/30
                                      {% else %}
                                      bg-blue-50 border border-blue-200 text-blue-700
                                      hover:bg-blue-100 hover:border-blue-300
                                      {% endif %}">
                                مشاهده
                            </a>
                            
                            {% if user.role in 'owner,accountant' %}
                            <a href="{% url 'jewelry:inventory_edit' item.pk %}" 
                               class="flex-1 text-center px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300
                                      {% if is_dark_mode %}
                                      bg-cyber-neon-secondary/20 border border-cyber-neon-secondary/30 text-cyber-neon-secondary
                                      hover:border-cyber-neon-secondary/50 hover:bg-cyber-neon-secondary/30
                                      {% else %}
                                      bg-green-50 border border-green-200 text-green-700
                                      hover:bg-green-100 hover:border-green-300
                                      {% endif %}">
                                ویرایش
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Pagination -->
        {% if is_paginated %}
        <div class="px-6 py-4 border-t 
                    {% if is_dark_mode %}border-cyber-text-muted/20{% else %}border-gray-200{% endif %}">
            <div class="flex items-center justify-between">
                <div class="text-sm {% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                    نمایش 
                    <span class="persian-numbers">{{ page_obj.start_index }}</span> 
                    تا 
                    <span class="persian-numbers">{{ page_obj.end_index }}</span> 
                    از 
                    <span class="persian-numbers">{{ paginator.count }}</span> 
                    کالا
                </div>
                
                <div class="flex items-center space-x-2 space-x-reverse">
                    {% if page_obj.has_previous %}
                    <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}" 
                       class="px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300
                              {% if is_dark_mode %}
                              bg-cyber-bg-surface/50 border border-cyber-text-muted/30 text-cyber-text-secondary
                              hover:border-cyber-text-secondary/50
                              {% else %}
                              bg-white text-gray-700 border border-gray-300
                              hover:bg-gray-50 hover:border-gray-400
                              {% endif %}">
                        قبلی
                    </a>
                    {% endif %}
                    
                    <span class="px-3 py-2 rounded-lg text-sm font-medium
                                {% if is_dark_mode %}
                                bg-cyber-neon-primary/20 border border-cyber-neon-primary/30 text-cyber-neon-primary
                                {% else %}
                                bg-blue-100 border border-blue-200 text-blue-700
                                {% endif %}">
                        <span class="persian-numbers">{{ page_obj.number }}</span>
                        از
                        <span class="persian-numbers">{{ paginator.num_pages }}</span>
                    </span>
                    
                    {% if page_obj.has_next %}
                    <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}" 
                       class="px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300
                              {% if is_dark_mode %}
                              bg-cyber-bg-surface/50 border border-cyber-text-muted/30 text-cyber-text-secondary
                              hover:border-cyber-text-secondary/50
                              {% else %}
                              bg-white text-gray-700 border border-gray-300
                              hover:bg-gray-50 hover:border-gray-400
                              {% endif %}">
                        بعدی
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
        
        {% else %}
        <!-- No Results -->
        <div class="p-12 text-center">
            <svg class="w-24 h-24 mx-auto mb-6 {% if is_dark_mode %}text-cyber-text-muted{% else %}text-gray-400{% endif %}" 
                 fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <h3 class="text-xl font-bold mb-2
                     {% if is_dark_mode %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                کالایی یافت نشد
            </h3>
            <p class="{% if is_dark_mode %}text-cyber-text-secondary{% else %}text-gray-600{% endif %} mb-6">
                با فیلترهای انتخابی شما کالایی پیدا نشد. لطفاً فیلترها را تغییر دهید یا کالای جدیدی اضافه کنید.
            </p>
            <div class="flex flex-wrap gap-3 justify-center">
                <a href="{% url 'jewelry:inventory_list' %}" 
                   class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all duration-300
                          {% if is_dark_mode %}
                          bg-cyber-bg-surface/50 border border-cyber-text-muted/30 text-cyber-text-secondary
                          hover:border-cyber-text-secondary/50
                          {% else %}
                          bg-white text-gray-700 border border-gray-300
                          hover:bg-gray-50 hover:border-gray-400
                          {% endif %}">
                    پاک کردن فیلترها
                </a>
                <a href="{% url 'jewelry:inventory_create' %}" 
                   class="inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all duration-300
                          {% if is_dark_mode %}
                          bg-gradient-to-r from-cyber-neon-primary/20 to-cyber-neon-secondary/20 
                          border border-cyber-neon-primary/30 text-cyber-neon-primary
                          hover:border-cyber-neon-primary/50 hover:shadow-lg hover:shadow-cyber-neon-primary/20
                          {% else %}
                          bg-blue-600 text-white border border-blue-600
                          hover:bg-blue-700 hover:border-blue-700
                          {% endif %}">
                    افزودن کالای جدید
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Persian number formatting
    const persianNumberElements = document.querySelectorAll('.persian-numbers');
    persianNumberElements.forEach(element => {
        if (window.PersianNumbers) {
            element.textContent = window.PersianNumbers.toPersian(element.textContent);
        }
    });
    
    // Auto-submit form on filter changes
    const filterForm = document.getElementById('filterForm');
    const filterInputs = filterForm.querySelectorAll('select, input[type="checkbox"]');
    
    filterInputs.forEach(input => {
        input.addEventListener('change', function() {
            if (this.type !== 'text' && this.type !== 'number') {
                filterForm.submit();
            }
        });
    });
    
    // Search input debounce
    const searchInput = filterForm.querySelector('input[name="search"]');
    let searchTimeout;
    
    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            if (this.value.length >= 2 || this.value.length === 0) {
                filterForm.submit();
            }
        }, 500);
    });
});

function changePageSize(size) {
    const url = new URL(window.location);
    url.searchParams.set('page_size', size);
    url.searchParams.delete('page'); // Reset to first page
    window.location.href = url.toString();
}
</script>
{% endblock %}