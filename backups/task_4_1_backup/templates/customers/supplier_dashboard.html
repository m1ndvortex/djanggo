{% extends "base_rtl.html" %}
{% load static %}

{% block title %}مدیریت تامین‌کنندگان - زرگر{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/supplier-management.css' %}">
<script src="{% static 'js/supplier-management.js' %}" defer></script>
{% endblock %}

{% block content %}
<div class="min-h-screen 
     {% if user.theme_preference == 'dark' %}
     bg-gradient-to-br from-cyber-bg-primary via-cyber-bg-secondary to-cyber-bg-surface
     {% else %}
     bg-gradient-to-br from-gray-50 to-gray-100
     {% endif %}"
     x-data="supplierDashboard()" 
     x-init="initDashboard()"
     :class="{ 'dark': darkMode, 'light': !darkMode }">

    <!-- Header -->
    <header class="{% if user.theme_preference == 'dark' %}cyber-glass-header{% else %}bg-white/80 backdrop-blur-sm border-b border-gray-200{% endif %} sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="{% if user.theme_preference == 'dark' %}cyber-logo-container{% else %}bg-blue-600 p-2 rounded-lg{% endif %}">
                        <svg class="h-8 w-8 {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-white{% endif %}" 
                             fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8a1 1 0 0 0-1-1zM10 6a2 2 0 0 1 4 0v1h-4V6zm6 14H8a1 1 0 0 1-1-1V9h2v1a1 1 0 0 0 2 0V9h2v1a1 1 0 0 0 2 0V9h2v10a1 1 0 0 1-1 1z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold {% if user.theme_preference == 'dark' %}text-cyber-text-primary cyber-glow-text{% else %}text-gray-900{% endif %}">
                            مدیریت تامین‌کنندگان
                        </h1>
                        <p class="text-sm {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-blue-600{% endif %}">
                            تامین‌کنندگان، سفارشات خرید و عملکرد
                        </p>
                    </div>
                </div>
                
                <!-- Navigation -->
                <nav class="hidden md:flex items-center space-x-6 space-x-reverse">
                    <a href="{% url 'customers:supplier_dashboard' %}" 
                       class="{% if user.theme_preference == 'dark' %}cyber-nav-link active{% else %}nav-link active{% endif %}">
                        داشبورد تامین‌کنندگان
                    </a>
                    <a href="{% url 'customers:supplier_list' %}" 
                       class="{% if user.theme_preference == 'dark' %}cyber-nav-link{% else %}nav-link{% endif %}">
                        لیست تامین‌کنندگان
                    </a>
                    <a href="{% url 'customers:purchase_order_list' %}" 
                       class="{% if user.theme_preference == 'dark' %}cyber-nav-link{% else %}nav-link{% endif %}">
                        سفارشات خرید
                    </a>
                    <a href="{% url 'customers:supplier_performance' %}" 
                       class="{% if user.theme_preference == 'dark' %}cyber-nav-link{% else %}nav-link{% endif %}">
                        گزارش عملکرد
                    </a>
                    <a href="/" 
                       class="{% if user.theme_preference == 'dark' %}cyber-nav-link{% else %}nav-link{% endif %}">
                        بازگشت به داشبورد
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        
        <!-- Quick Actions -->
        <div class="flex flex-wrap gap-4 mb-8">
            <a href="{% url 'customers:supplier_create' %}" 
               class="{% if user.theme_preference == 'dark' %}cyber-button-primary{% else %}bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700{% endif %} inline-flex items-center">
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
                تامین‌کننده جدید
            </a>
            <a href="{% url 'customers:purchase_order_create' %}" 
               class="{% if user.theme_preference == 'dark' %}cyber-button-secondary{% else %}bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700{% endif %} inline-flex items-center">
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                سفارش خرید جدید
            </a>
        </div>

        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            
            <!-- Total Suppliers -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-metric-card{% else %}metric-card{% endif %} animate-fade-in-up">
                <div class="flex items-center">
                    <div class="{% if user.theme_preference == 'dark' %}cyber-icon-container primary{% else %}icon-container primary{% endif %}">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                    </div>
                    <div class="mr-3">
                        <p class="text-sm font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                            کل تامین‌کنندگان
                        </p>
                        <p class="text-2xl font-bold {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary cyber-number-glow{% else %}text-gray-900{% endif %} persian-numbers">
                            {{ total_suppliers }}
                        </p>
                    </div>
                </div>
                <div class="mt-2">
                    <span class="text-sm {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary{% else %}text-green-600{% endif %} persian-numbers">
                        {{ active_suppliers }} فعال
                    </span>
                    <span class="text-sm {% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} persian-numbers">
                        • {{ inactive_suppliers }} غیرفعال
                    </span>
                </div>
            </div>

            <!-- Preferred Suppliers -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-metric-card{% else %}metric-card{% endif %} animate-fade-in-up" style="animation-delay: 0.1s">
                <div class="flex items-center">
                    <div class="{% if user.theme_preference == 'dark' %}cyber-icon-container success{% else %}icon-container success{% endif %}">
                        <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <div class="mr-3">
                        <p class="text-sm font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                            تامین‌کنندگان ترجیحی
                        </p>
                        <p class="text-2xl font-bold {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary cyber-number-glow{% else %}text-gray-900{% endif %} persian-numbers">
                            {{ preferred_suppliers }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Total Orders -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-metric-card{% else %}metric-card{% endif %} animate-fade-in-up" style="animation-delay: 0.2s">
                <div class="flex items-center">
                    <div class="{% if user.theme_preference == 'dark' %}cyber-icon-container tertiary{% else %}icon-container tertiary{% endif %}">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                    </div>
                    <div class="mr-3">
                        <p class="text-sm font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                            کل سفارشات
                        </p>
                        <p class="text-2xl font-bold {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary cyber-number-glow{% else %}text-gray-900{% endif %} persian-numbers">
                            {{ order_stats.total_orders }}
                        </p>
                    </div>
                </div>
                <div class="mt-2">
                    {% if overdue_orders > 0 %}
                    <span class="text-sm {% if user.theme_preference == 'dark' %}text-cyber-neon-danger{% else %}text-red-600{% endif %} persian-numbers">
                        {{ overdue_orders }} معوقه
                    </span>
                    {% else %}
                    <span class="text-sm {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary{% else %}text-green-600{% endif %}">
                        بدون سفارش معوقه
                    </span>
                    {% endif %}
                </div>
            </div>

            <!-- Total Amount -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-metric-card{% else %}metric-card{% endif %} animate-fade-in-up" style="animation-delay: 0.3s">
                <div class="flex items-center">
                    <div class="{% if user.theme_preference == 'dark' %}cyber-icon-container warning{% else %}icon-container warning{% endif %}">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <div class="mr-3">
                        <p class="text-sm font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-500{% endif %}">
                            مجموع خریدها
                        </p>
                        <p class="text-2xl font-bold {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary cyber-number-glow{% else %}text-gray-900{% endif %} persian-numbers">
                            {{ order_stats.total_amount|floatformat:0 }}
                        </p>
                        <p class="text-xs {% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %}">
                            تومان
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Supplier Types Distribution & Top Suppliers -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            
            <!-- Supplier Types Distribution -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-glass-card{% else %}bg-white rounded-lg shadow{% endif %} p-6">
                <h3 class="text-lg font-semibold {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %} mb-4">
                    توزیع انواع تامین‌کننده
                </h3>
                
                <div class="space-y-4">
                    {% for supplier_type in supplier_types %}
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-4 h-4 rounded-full mr-3
                                        {% if supplier_type.supplier_type == 'manufacturer' %}bg-blue-500
                                        {% elif supplier_type.supplier_type == 'wholesaler' %}bg-green-500
                                        {% elif supplier_type.supplier_type == 'gemstone_dealer' %}bg-purple-500
                                        {% elif supplier_type.supplier_type == 'gold_supplier' %}bg-yellow-500
                                        {% elif supplier_type.supplier_type == 'service_provider' %}bg-red-500
                                        {% else %}bg-gray-400{% endif %}">
                            </div>
                            <span class="{% if user.theme_preference == 'dark' %}text-cyber-text-secondary{% else %}text-gray-600{% endif %}">
                                {% if supplier_type.supplier_type == 'manufacturer' %}تولیدکننده
                                {% elif supplier_type.supplier_type == 'wholesaler' %}عمده‌فروش
                                {% elif supplier_type.supplier_type == 'gemstone_dealer' %}فروشنده سنگ قیمتی
                                {% elif supplier_type.supplier_type == 'gold_supplier' %}تامین‌کننده طلا
                                {% elif supplier_type.supplier_type == 'service_provider' %}ارائه‌دهنده خدمات
                                {% else %}سایر{% endif %}
                            </span>
                        </div>
                        <span class="font-bold {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary{% else %}text-gray-900{% endif %} persian-numbers">
                            {{ supplier_type.count }}
                        </span>
                    </div>
                    {% empty %}
                    <p class="{% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} text-center py-4">
                        هنوز تامین‌کننده‌ای ثبت نشده است
                    </p>
                    {% endfor %}
                </div>
            </div>

            <!-- Top Suppliers by Amount -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-glass-card{% else %}bg-white rounded-lg shadow{% endif %} p-6">
                <h3 class="text-lg font-semibold {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %} mb-4">
                    برترین تامین‌کنندگان (مبلغ)
                </h3>
                
                <div class="space-y-3">
                    {% for supplier in top_suppliers %}
                    <div class="flex items-center justify-between p-3 {% if user.theme_preference == 'dark' %}cyber-glass-base{% else %}bg-gray-50{% endif %} rounded-lg">
                        <div class="flex items-center">
                            <div class="{% if user.theme_preference == 'dark' %}cyber-avatar{% else %}bg-blue-100 p-2 rounded-full{% endif %}">
                                <svg class="h-4 w-4 {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-blue-600{% endif %}" 
                                     fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8a1 1 0 0 0-1-1zM10 6a2 2 0 0 1 4 0v1h-4V6zm6 14H8a1 1 0 0 1-1-1V9h2v1a1 1 0 0 0 2 0V9h2v1a1 1 0 0 0 2 0V9h2v10a1 1 0 0 1-1 1z"/>
                                </svg>
                            </div>
                            <div class="mr-3">
                                <p class="font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                                    {{ supplier.persian_name|default:supplier.name }}
                                </p>
                                <p class="text-xs {% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %}">
                                    {{ supplier.total_orders }} سفارش
                                </p>
                                {% if supplier.is_preferred %}
                                <span class="{% if user.theme_preference == 'dark' %}cyber-badge success{% else %}bg-green-100 text-green-800 px-2 py-1 rounded text-xs{% endif %}">
                                    ترجیحی
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="text-left">
                            <p class="font-bold {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary{% else %}text-gray-900{% endif %} persian-numbers">
                                {{ supplier.total_amount|floatformat:0 }}
                            </p>
                            <p class="text-xs {% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %}">
                                تومان
                            </p>
                        </div>
                    </div>
                    {% empty %}
                    <p class="{% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} text-center py-4">
                        هنوز سفارشی ثبت نشده است
                    </p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Recent Suppliers & Pending Orders -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            
            <!-- Recent Suppliers -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-glass-card{% else %}bg-white rounded-lg shadow{% endif %} p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                        تامین‌کنندگان جدید
                    </h3>
                    <a href="{% url 'customers:supplier_list' %}" 
                       class="text-sm {% if user.theme_preference == 'dark' %}text-cyber-neon-primary hover:text-cyber-neon-secondary{% else %}text-blue-600 hover:text-blue-800{% endif %}">
                        مشاهده همه
                    </a>
                </div>
                
                <div class="space-y-3">
                    {% for supplier in recent_suppliers %}
                    <div class="flex items-center justify-between p-3 {% if user.theme_preference == 'dark' %}cyber-glass-base{% else %}bg-gray-50{% endif %} rounded-lg">
                        <div class="flex items-center">
                            <div class="{% if user.theme_preference == 'dark' %}cyber-avatar{% else %}bg-gray-100 p-2 rounded-full{% endif %}">
                                <svg class="h-4 w-4 {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-gray-600{% endif %}" 
                                     fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8a1 1 0 0 0-1-1zM10 6a2 2 0 0 1 4 0v1h-4V6zm6 14H8a1 1 0 0 1-1-1V9h2v1a1 1 0 0 0 2 0V9h2v1a1 1 0 0 0 2 0V9h2v10a1 1 0 0 1-1 1z"/>
                                </svg>
                            </div>
                            <div class="mr-3">
                                <p class="font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                                    {{ supplier.persian_name|default:supplier.name }}
                                </p>
                                <p class="text-xs {% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %}">
                                    {{ supplier.get_supplier_type_display }}
                                </p>
                            </div>
                        </div>
                        <div class="text-left">
                            <p class="text-xs {% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} persian-numbers">
                                {{ supplier.created_at|date:"Y/m/d" }}
                            </p>
                            <span class="{% if supplier.is_active %}{% if user.theme_preference == 'dark' %}cyber-badge success{% else %}bg-green-100 text-green-800 px-2 py-1 rounded text-xs{% endif %}{% else %}{% if user.theme_preference == 'dark' %}cyber-badge danger{% else %}bg-red-100 text-red-800 px-2 py-1 rounded text-xs{% endif %}{% endif %}">
                                {% if supplier.is_active %}فعال{% else %}غیرفعال{% endif %}
                            </span>
                        </div>
                    </div>
                    {% empty %}
                    <p class="{% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} text-center py-4">
                        هنوز تامین‌کننده‌ای ثبت نشده است
                    </p>
                    {% endfor %}
                </div>
            </div>

            <!-- Pending Purchase Orders -->
            <div class="{% if user.theme_preference == 'dark' %}cyber-glass-card{% else %}bg-white rounded-lg shadow{% endif %} p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                        سفارشات در انتظار
                    </h3>
                    <a href="{% url 'customers:purchase_order_list' %}" 
                       class="text-sm {% if user.theme_preference == 'dark' %}text-cyber-neon-primary hover:text-cyber-neon-secondary{% else %}text-blue-600 hover:text-blue-800{% endif %}">
                        مشاهده همه
                    </a>
                </div>
                
                <div class="space-y-3">
                    {% for order in pending_orders %}
                    <div class="flex items-center justify-between p-3 {% if user.theme_preference == 'dark' %}cyber-glass-base{% else %}bg-gray-50{% endif %} rounded-lg">
                        <div class="flex items-center">
                            <div class="{% if user.theme_preference == 'dark' %}cyber-avatar{% else %}bg-gray-100 p-2 rounded-full{% endif %}">
                                <svg class="h-4 w-4 {% if user.theme_preference == 'dark' %}text-cyber-neon-primary{% else %}text-gray-600{% endif %}" 
                                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </div>
                            <div class="mr-3">
                                <p class="font-medium {% if user.theme_preference == 'dark' %}text-cyber-text-primary{% else %}text-gray-900{% endif %}">
                                    {{ order.order_number }}
                                </p>
                                <p class="text-xs {% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %}">
                                    {{ order.supplier.persian_name|default:order.supplier.name }}
                                </p>
                            </div>
                        </div>
                        <div class="text-left">
                            <p class="font-bold {% if user.theme_preference == 'dark' %}text-cyber-neon-secondary{% else %}text-gray-900{% endif %} persian-numbers">
                                {{ order.total_amount|floatformat:0 }}
                            </p>
                            <span class="{% if order.status == 'draft' %}{% if user.theme_preference == 'dark' %}cyber-badge warning{% else %}bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs{% endif %}{% elif order.status == 'sent' %}{% if user.theme_preference == 'dark' %}cyber-badge primary{% else %}bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs{% endif %}{% elif order.status == 'confirmed' %}{% if user.theme_preference == 'dark' %}cyber-badge success{% else %}bg-green-100 text-green-800 px-2 py-1 rounded text-xs{% endif %}{% endif %}">
                                {{ order.get_status_display }}
                            </span>
                        </div>
                    </div>
                    {% empty %}
                    <p class="{% if user.theme_preference == 'dark' %}text-cyber-text-muted{% else %}text-gray-500{% endif %} text-center py-4">
                        هیچ سفارش در انتظاری وجود ندارد
                    </p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </main>
</div>

<script>
function supplierDashboard() {
    return {
        darkMode: localStorage.getItem('theme') === 'dark',
        loading: false,
        
        initDashboard() {
            console.log('Supplier dashboard initialized');
        },
        
        toggleSupplierStatus(supplierId, field) {
            this.loading = true;
            
            fetch('{% url "customers:supplier_ajax" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': window.csrfToken
                },
                body: `action=toggle_${field}&supplier_id=${supplierId}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    this.showMessage(data.message, 'success');
                    // Reload page to update UI
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    this.showMessage(data.error, 'error');
                }
            })
            .catch(error => {
                this.showMessage('خطا در ارتباط با سرور', 'error');
            })
            .finally(() => {
                this.loading = false;
            });
        },
        
        showMessage(message, type) {
            // Create and show message
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm ${
                type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
                type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
                'bg-blue-100 text-blue-800 border border-blue-200'
            }`;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
    }
}
</script>
{% endblock %}